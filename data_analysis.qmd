---
title: "Nutrition support practices- Data analysis"
author: "Eric Anku, Dr. Lamptey Samad, George Akafity, Sarah Amoo, Dr. Lauren Hill"
format: docx
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```


```{r libraries}
pacman::p_load(
        rio, # Import dataset
        finalfit, # Labelling and data inspection
        gtsummary, # Summary tables
        tidyverse, # Data wrangling and visualisation
        janitor, # Data cleaning
        ggstatsplot, # Inferential plots
        here, # Working directory
        naniar, # Missing values
        skimr, # Skim daataset
        psych, # Describe dataset
        lessR, # Multiple plots and statistical tests
        forcats, # Working with factors
        ggthemes, # Themes
        questionr, # Multiple choice questions
        broom
)
```

```{r import-datasets}
# Full clean dataset
nss <- import(here("data","nss_merge_clean.RData"))

# Subset dataset
## Demographics
demographics <- import(here("data","demographics_merge.RData"))
en <- import(here("data","enteral_nutrition_merge.RData"))
mcqs <- import(here("data","mcqs_merge.RData"))
nutrition_assessment <- import(here("data","nutrition_assessment_merge.RData"))
ons <- import(here("data","oral_nutrition_supplement_merge.RData"))
pn <- import(here("data","parenteral_nutrition_merge.RData"))
skills <- import(here("data","skills_merge.RData"))
decision <- import(here("data","decision_merge.RData"))
```




****

## Summary tables for all respondents



```{r demographics}
demographics%>%
  select(-nutrition_support_team)%>%
        tbl_summary(
          missing_text ="No response"
        )%>%
        modify_caption("**Characteristics of participants**")%>%
        bold_labels()
```


```{r nutrition-assessment, eval=FALSE}
t2 <- nutrition_assessment%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                profession_doctor_nurse
        ))%>%
        tbl_summary(
          missing_text = "No response"
        )%>%
        modify_caption("**Nutrition screening and assessment**")%>%
        bold_labels()
```


```{r nutrition-decision, eval=FALSE}
t3 <- decision%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                profession_doctor_nurse
        ))%>%
        tbl_summary(
          missing_text = "No response"
        )%>%
        modify_caption("**Nutrition support decision making**")%>%
        bold_labels()
```

```{r tbl-stack-one, eval=FALSE}
tbl_stack(list(t2, t3), group_header = c("Nutrition screening and assessment", "Nutrition support decision making"))
```


```{r enteral-nutrition, eval=FALSE}
t4 <- en%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                profession_doctor_nurse
        ))%>%
        tbl_summary(
          missing_text = "No response"
        )%>%
        modify_caption("**Enteral nutrition support practices**")%>%
        bold_labels()
```

```{r oral-nutrition, eval=FALSE}
t5<- ons%>%select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                profession_doctor_nurse
        ))%>%
        tbl_summary(
          missing_text = "No response"
        )%>%
        modify_caption("**Oral nutrition support practices**")%>%
        bold_labels()
```


```{r pn, eval=FALSE}
t6 <- pn%>%select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                profession_doctor_nurse
        ))%>%
        tbl_summary(
          missing_text = "No response"
        )%>%
        modify_caption("**Parenteral nutrition support practices**")%>%
        bold_labels()
```

```{r tbl-stack-all-nsp, eval=FALSE}
tbl_stack(list(t4,t5, t6), group_header = c("Enteral nutrition support practices", "Oral nutrition supplement", "Parenteral nutrition support"))
```


```{r skills-training, eval=FALSE}
t7 <- skills%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                profession_doctor_nurse,
                other_info
        ))%>%
        tbl_summary(
          missing_text = "No response"
        )%>%
        modify_caption("**Skills and training**")%>%
        bold_labels()

t7
```


****

## Subcategory summary tables


### Professions analysis


```{r subgroup-nutrition-assessment}
t8 <- nutrition_assessment%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses
        ))%>%
        tbl_summary(
                by = profession_doctor_nurse,
                missing = "no"
        )%>%
        modify_caption("**Nutrition screening and assessment by profession**")%>%
        bold_labels()%>%
        add_p()%>%
        bold_p()%>%add_overall()
```


```{r subgroup-decision}
t9 <- decision%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses
        ))%>%
        tbl_summary(
                by = profession_doctor_nurse,
                missing = "no"
        )%>%
        modify_caption("**Nutrition support decision making by profession**")%>%
        bold_labels()%>%
        add_p()%>%
        bold_p()%>%add_overall()
```


```{r subgroup-enteral-nutrition}
t10 <- en%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses
        ))%>%
        tbl_summary(
                by = profession_doctor_nurse,
                missing = "no"
        )%>%
        modify_caption("**Enteral nutrition support practices by profession**")%>%
        bold_labels()%>%
        add_p()%>%
        bold_p()%>%add_overall()
```


```{r subgroup-ons}
t11 <- ons%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses
        ))%>%
        tbl_summary(
                by = profession_doctor_nurse,
                missing = "no"
        )%>%
        modify_caption("**Oral nutrition support practices by profession**")%>%
        bold_labels()%>%
        add_p()%>%
        bold_p()%>%add_overall()
```



```{r subgroup-pn}
t12 <- pn%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses
        ))%>%
        tbl_summary(
                by = profession_doctor_nurse,
                missing = "no"
        )%>%
        modify_caption("**Parenteral nutrition support practices by profession**")%>%
        bold_labels()%>%
        add_p()%>%
        bold_p()%>%add_overall()
```

```{r tbl-stack-nsp}
tbl_stack(list(t8,t9, t10, t11, t12), group_header = c("Nutrition assessment","Nutrition support decision making", "Enteral nutrition support practices", "Oral nutrition supplement practices", "Parenteral nutrition support practices"))
```



```{r subgroup-skills}
t13 <- skills%>%
        select(-c(
                years_experience_factor,
                years_working_icu_factor,
                educ_level_nurses,
                other_info
        ))%>%
        tbl_summary(
                by = profession_doctor_nurse,
                missing = "no"
        )%>%
        modify_caption("**Skills and training by profession**")%>%
        bold_labels()%>%
        add_p()%>%
        bold_p()%>%add_overall()
t13
```


```{r plot-competence, eval=FALSE}
ggplot(data = skills, aes(competence)) +
  geom_bar() +
  labs(title = "Self-reported competence of professionals", x="Self-reported competence", y="Frequency") +  scale_x_discrete(labels=c('Satisfactory/Average', 'Above-average', 'Below average', 'Totally unskilled')) + theme_ggstatsplot() +
  facet_wrap(~ profession_doctor_nurse) + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r plot-source-info, eval=FALSE}
ggplot(data = skills, aes(source_info)) +
  geom_bar() +
  labs(title = "Main source of nutrition support information", x="Source of nutrition support information", y="Frequency") + facet_wrap(~profession_doctor_nurse) + scale_x_discrete(labels=c('Feeding protocol', 'In-service training', 'Colleagues', 'Journal articles', 'Workshop/Conference', 'Others')) + theme_ggstatsplot() + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## Multiple choice questions

```{r split-multiple-choice-questions}
# Nutrition tools
nutrition_tools <- multi.split(mcqs$nutrition_tools, split.char = ";", mnames = c("BMI/body_weight_assessment", "Subjective Global Assessment", "Nutrition risk screening (NRS) 2002", "Nutrition risk in critically ill (NUTRIC)", "Malnutrition universal screening tool", "Combination of anthropometric, biochemical, clinical, dietary, enviromnmental","Do not know/Not sure"))

# Nutrition requirement
nutrition_requirement <- multi.split(mcqs$nutrition_requirement, split.char = ";")

# Commence en
commence_en <- multi.split(mcqs$commence_en, split.char = ";")

# Commence pn
commence_pn <- multi.split(mcqs$commence_pn, split.char = ";")

# Basis en
basis_en <- multi.split(mcqs$basis_en, split.char = ";")

# Feed tolerance en
feed_tolerance <- multi.split(mcqs$feed_tolerance_en, split.char = ";")

# Monitoring en
monitoring_en <- multi.split(mcqs$methods_monitoring_en, split.char = ";")

# Rationale ons
rationale_ons <- multi.split(mcqs$rationale_ons, split.char = ";")

# Timing pn
timing_pn <- multi.split(mcqs$timing_pn, split.char = ";")

# Monitoring pn
monitoring_pn <- multi.split(mcqs$monitoring_pn, split.char = ";")

```

```{r frequency-tables}
# Nutrition tools
freq_nutrition_tools <- multi.table(nutrition_tools)

# Nutrition requirement
freq_nutrition_req <- multi.table(nutrition_requirement)

# Commence en
freq_commence_en <- multi.table(commence_en)

# Commence pn
freq_commence_pn <- multi.table(commence_pn)

# Basis en
freq_basis_en <- multi.table(basis_en)

# Feed tolerance en
freq_tolerance_en <- multi.table(feed_tolerance)

# Monitoring en
freq_monitoring_en <- multi.table(monitoring_en)

# Rationale ons
freq_rationale <- multi.table(rationale_ons)

# Timing pn
freq_timing_pn <- multi.table(timing_pn)

# Monitoring pn
freq_monitoring_pn <- multi.table(monitoring_pn)
```


```{r barplot, eval = FALSE}
barplot(multitab[[1]], names.arg = row.names(multitab), main = "What nutrition screening/assessment methods or tools are used?", xlab = "Responses", ylab = "Frequency")
```

